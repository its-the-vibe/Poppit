[Unit]
Description=Poppit - Redis notification processor for CI/CD
After=network.target redis.service
Wants=redis.service

[Service]
Type=simple
User=poppit
Group=poppit
WorkingDirectory=/opt/poppit
ExecStart=/opt/poppit/poppit
Restart=always
RestartSec=10

# Environment variables - all prefixed with POPPIT_SERVICE_ to avoid conflicts
Environment="POPPIT_SERVICE_REDIS_ADDR=localhost:6379"
Environment="POPPIT_SERVICE_REDIS_LIST_NAME=poppit:notifications"
Environment="POPPIT_SERVICE_REDIS_PUBLISH_LIST_NAME=slack_messages"
Environment="POPPIT_SERVICE_SLACK_CHANNEL=#ci-cd"
Environment="POPPIT_SERVICE_DEFAULT_TTL=86400"
Environment="POPPIT_SERVICE_COMMAND_OUTPUT_CHANNEL=poppit:command-output"

# Security hardening
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/tmp

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=poppit

[Install]
WantedBy=multi-user.target
